# コンパイラとしてのShapes Generator

## 用語の定義

以下では基本的に v2 の用語を定義する。例外的にいくつかの用語は v1 にも通用する。

 - 集合 **V** を固定する。

 - 有限集合 **SK** を固定する。
   - SK の要素を**SOPキー**(Shape Object Property Key)と呼ぶ

 - 各SOPキー k について、V の部分集合 V\_K を固定する
   - V の要素 v が v ∈ V\_k を満たすとき、「k は v を**受理する**」という

 - 図形オブジェクトプロパティマップ(SOPM)
   - SK から V への部分関数 f のうち、 k ∈ SK について
     - f(k) が定義されていれば k は f(k) を受理する
     
     が満たされているものを**図形オブジェクトプロパティマップ(Shape Object Property Map; SOPM)**と定義する。

 - 図形オブジェクト
   - 図形オブジェクトは、以下の２つの組である：
     - 図形、または同期図形
     - modifier の有限列
   - このうち、図形とmodifierの有限列の組である図形オブジェクトを**plainな**図形オブジェクトと定義する
   - 図形オブジェクト o からは、一定の規則に基づいてSOPキーの集合 K\_o ⊂ SK が計算できる
     - o から K\_o を計算するための規則を**キー型付け規則**と呼ぶ(具体的なキー型付け規則は実装詳細)
     - K\_o を o の**キー型**と呼ぶ

 - 図形プログラム
   - 図形オブジェクトの列を**図形プログラム**と呼ぶ
   - 図形プログラムは(TODO: "forward-referenceが無い"旨を追加)の時、**well-formed**であるという
   - well-formedな図形プログラム内の図形オブジェクト o からは、
     その**差分展開** DiffExp(o) が計算できる場合がある(実装詳細)
     
     - 差分展開はplainな図形オブジェクトであって、同期図形の参照の解決と差分の適用を再帰的に行ったものと考えてよい
     - DiffExp(o) が計算できる時、 o は**well-definedな差分定義を持つ**と言う
   - plainな図形オブジェクト o は、well-typedなmodifierリストを持つ(FIXME: これは未定義)とき、
     o はwell-typeであるという。
   - well-formedな図形プログラムのうち、すべての図形オブジェクトがwell-definedな差分展開を持ち、
     しかも差分展開がすべてwell-typedであれば、各図形オブジェクト o に対して SOPM である Compile(o) が計算できる。
     この時得られる Compile(o) の列を**コンパイル結果**と呼ぶ。コンパイル結果はShapes Generatorの重要な中間生成物である。
